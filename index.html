<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì² ë„ì‹ í˜¸ì œì–´ì‹œì„¤ ì‘ì—…ì¼ì§€</title>
    
    <!-- PWA ë©”íƒ€ íƒœê·¸ -->
    <meta name="description" content="ì² ë„ì‹ í˜¸ì œì–´ì‹œì„¤ ì‘ì—…ì¼ì§€ ì‘ì„± ë° ê´€ë¦¬ ì•±">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ì‘ì—…ì¼ì§€">
    <meta name="msapplication-TileColor" content="#2563eb">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì—°ê²° -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- ì•„ì´ì½˜ -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIGZpbGw9IiMyNTYzZWIiIHJ4PSI0Ii8+PHBhdGggZD0iTTcgNGgxdjE2SDRWNGgzek0xMyA0djE2SDEwVjRoM3pNMTkgNHYxNkgxNlY0aDN6IiBmaWxsPSJ3aGl0ZSIvPjxwYXRoIGQ9Ik02IDEwSDE4IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiLz48cGF0aCBkPSJNNiAxNEgxOCIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIyIi8+PC9zdmc+">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxyZWN0IHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0iIzI1NjNlYiIgcng9IjQiLz48cGF0aCBkPSJNNyA0aDF2MTZINFY0aDN6TTEzIDR2MTZIMTBWNGgzek0xOSA0djE2SDE2VjRoM3oiIGZpbGw9IndoaXRlIi8+PHBhdGggZD0iTTYgMTBIMTgiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMiIvPjxwYXRoIGQ9Ik02IDE0SDE4IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiLz48L3N2Zz4=">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        
        .header-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #60a5fa 100%);
            position: relative;
            overflow: hidden;
        }
        
        .header-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 600'%3E%3Cg fill='none' stroke='rgba(255,255,255,0.1)' stroke-width='2'%3E%3Cpath d='M100 300h50v-50h50v50h50v-50h50v50h50v-50h50v50h50v-50h50v50h50v-50h50v50h50v-50h50v50h50v-50h50v50h50'/%3E%3Ccircle cx='200' cy='200' r='20'/%3E%3Ccircle cx='400' cy='200' r='20'/%3E%3Ccircle cx='600' cy='200' r='20'/%3E%3Ccircle cx='800' cy='200' r='20'/%3E%3Ccircle cx='1000' cy='200' r='20'/%3E%3Cpath d='M150 150v100M250 150v100M350 150v100M450 150v100M550 150v100M650 150v100M750 150v100M850 150v100M950 150v100M1050 150v100'/%3E%3Cpath d='M100 400h1000M100 420h1000'/%3E%3C/g%3E%3C/svg%3E");
            background-size: cover;
            background-position: center;
            opacity: 0.3;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .grid-input {
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 14px;
            transition: all 0.2s;
            background: #f9fafb;
        }
        
        .grid-input:focus {
            outline: none;
            border-color: #3b82f6;
            background: white;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .grid-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .grid-table {
            min-width: 800px;
        }
        
        .tooltip {
            position: relative;
        }
        
        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            margin-bottom: 5px;
        }
        
        .tooltip:hover::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #1f2937;
            margin-bottom: -5px;
        }
        
        .lined-textarea {
            background-attachment: local;
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 14px;
            padding: 8px;
        }
        
        /* ì‘ì—…ë‚´ìš©: 1ì¤„ ê²©ì */
        #workContent {
            background-image: repeating-linear-gradient(
                transparent,
                transparent 39px,
                #d1d5db 39px,
                #d1d5db 40px
            );
            line-height: 40px;
            height: 50px !important;
            min-height: 50px !important;
            max-height: 50px !important;
            overflow: hidden !important;
            resize: none !important;
        }
        
        #workContent:focus {
            background-image: repeating-linear-gradient(
                transparent,
                transparent 39px,
                #9ca3af 39px,
                #9ca3af 40px
            );
        }
        
        /* íŠ¹ì´ì‚¬í•­: 3ì¤„ ê²©ì */
        #specialNotes {
            background-image: repeating-linear-gradient(
                transparent,
                transparent 39px,
                #d1d5db 39px,
                #d1d5db 40px
            );
            line-height: 40px;
            height: 130px !important;
            min-height: 130px !important;
            max-height: 130px !important;
            overflow: hidden !important;
            resize: none !important;
        }
        
        #specialNotes:focus {
            background-image: repeating-linear-gradient(
                transparent,
                transparent 39px,
                #9ca3af 39px,
                #9ca3af 40px
            );
        }
        
        @media print {
            @page {
                size: A4 landscape;
                margin: 0;
            }
            
            .no-print { display: none !important; }
            
            /* ëª¨ë“  ê¸°ë³¸ ìš”ì†Œ ìˆ¨ê¸°ê¸° */
            body > *:not(#pdf-duplicate) {
                display: none !important;
            }
            
            /* placeholder í…ìŠ¤íŠ¸ ìˆ¨ê¸°ê¸° */
            input::placeholder,
            textarea::placeholder {
                color: transparent !important;
            }
            
            html, body { 
                width: 297mm !important;
                height: 210mm !important;
                margin: 0 !important;
                padding: 0 !important;
                overflow: hidden !important;
                font-size: 8px !important;
                background: white !important;
            }
            
            /* PDF ì»¨í…Œì´ë„ˆ - CSS Gridë¡œ ì •í™•í•œ ë¶„í•  */
            .pdf-only {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
                width: 297mm !important;
                height: 210mm !important;
                margin: 0 !important;
                padding: 0 !important;
                gap: 0 !important;
                background: white !important;
                overflow: hidden !important;
            }
            
            /* Grid ì•„ì´í…œìœ¼ë¡œ ì •í™•í•œ 50:50 */
            #pdf-duplicate > main {
                width: 100% !important;
                height: 210mm !important;
                margin: 0 !important;
                padding: 3mm !important;
                border: 1px solid #000 !important;
                background: white !important;
                box-sizing: border-box !important;
                overflow: hidden !important;
                display: block !important;
                grid-column: span 1 !important;
            }
            
            #pdf-duplicate > main:first-child {
                border-right: 0.5px solid #000 !important;
            }
            
            #pdf-duplicate > main:last-child {
                border-left: 0.5px solid #000 !important;
            }
            
            .container {
                max-width: none !important;
                margin: 0 !important;
                padding: 1px !important;
                height: 100% !important;
                width: 100% !important;
                box-sizing: border-box !important;
            }
            
            .card { 
                box-shadow: none !important; 
                border: none !important;
                border-radius: 0 !important;
                padding: 2px 0 !important;
                margin-bottom: 3px !important;
                break-inside: avoid !important;
                page-break-inside: avoid !important;
                background: transparent !important;
            }
            
            .card h2 {
                font-size: 10px !important;
                margin-bottom: 4px !important;
                padding-bottom: 2px !important;
                border-bottom: 1px solid #333 !important;
                font-weight: bold !important;
                color: #000 !important;
            }
            
            /* ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ - PDF ì „ìš© - ëª¨ë“  ì…ë ¥ í•„ë“œì˜ í…Œë‘ë¦¬ ì œê±° */
            .pdf-only input, 
            .pdf-only textarea {
                font-size: 8px !important;
                padding: 2px 3px !important;
                border: none !important;
                border-radius: 0 !important;
                background: transparent !important;
                line-height: 1.3 !important;
                width: 100% !important;
                box-sizing: border-box !important;
                outline: none !important;
                height: 20px !important;
                box-shadow: none !important;
            }
            
            textarea {
                min-height: auto !important;
                height: auto !important;
                border: none !important;
                background: transparent !important;
                resize: none !important;
            }
            

            
            label {
                font-size: 9px !important;
                font-weight: 600 !important;
                margin-bottom: 2px !important;
                display: block !important;
                color: #333 !important;
            }
            
            /* ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ ì¡°ì • */
            .grid {
                gap: 3px !important;
                display: grid !important;
                width: 100% !important;
            }
            
            .grid-cols-1 {
                grid-template-columns: 1fr !important;
            }
            
            .grid-cols-2 {
                grid-template-columns: 1fr 1fr !important;
            }
            
            .grid-cols-3 {
                grid-template-columns: 1fr 1fr 1fr !important;
            }
            
            /* ê° div í¬ê¸° í†µì¼ */
            .grid > div {
                width: 100% !important;
                box-sizing: border-box !important;
            }
            
            /* PDFì—ì„œ ê²©ìì„  í‘œì‹œ */
            .lined-textarea {
                background-attachment: local !important;
                padding: 4px !important;
            }
            
            /* ì‘ì—…ë‚´ìš© ë³µì‚¬ë³¸: 1ì¤„ ê²©ì */
            .pdf-only #workContent_copy {
                height: 50px !important;
                border: none !important;
                line-height: 48px !important;
                padding: 2px 4px !important;
                background: transparent !important;
                background-image: linear-gradient(to bottom, transparent 48px, #333 48px, #333 49px, transparent 49px) !important;
                font-size: 8px !important;
                box-shadow: none !important;
                outline: none !important;
                overflow: hidden !important;
                resize: none !important;
                white-space: nowrap !important;
            }
            
            /* íŠ¹ì´ì‚¬í•­ ë³µì‚¬ë³¸: 3ì¤„ ê²©ì */
            .pdf-only #specialNotes_copy {
                height: 130px !important;
                border: none !important;
                line-height: 40px !important;
                padding: 2px 4px !important;
                background: transparent !important;
                background-image: 
                    linear-gradient(to bottom, transparent 40px, #333 40px, #333 41px, transparent 41px),
                    linear-gradient(to bottom, transparent 80px, #333 80px, #333 81px, transparent 81px),
                    linear-gradient(to bottom, transparent 120px, #333 120px, #333 121px, transparent 121px) !important;
                font-size: 8px !important;
                box-shadow: none !important;
                outline: none !important;
            }
            
            /* íˆ´íŒ ì œê±° */
            .tooltip:hover::after,
            .tooltip:hover::before {
                display: none !important;
            }
            
            /* ì•ˆë‚´ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸° */
            .text-gray-600 {
                display: none !important;
            }
            
            /* ëª¨ë°”ì¼ PDF ì¶œë ¥ ìµœì í™” */
            @media print and (max-width: 768px) {
                html, body {
                    width: 100vw !important;
                    height: 100vh !important;
                    font-size: 6px !important;
                    transform: scale(0.7) !important;
                    transform-origin: top left !important;
                }
                
                .pdf-only {
                    width: 100vw !important;
                    height: 100vh !important;
                    grid-template-columns: 50% 50% !important;
                    transform: scale(1) !important;
                }
                
                #pdf-duplicate > main {
                    height: 100vh !important;
                    padding: 2mm !important;
                    font-size: 6px !important;
                }
                
                .container {
                    padding: 1px !important;
                    margin: 0 !important;
                }
                
                .card {
                    margin-bottom: 1px !important;
                    padding: 1px 0 !important;
                }
                
                .card h2 {
                    font-size: 6px !important;
                    margin-bottom: 1px !important;
                    padding-bottom: 1px !important;
                }
                
                label {
                    font-size: 5px !important;
                    margin-bottom: 0px !important;
                }
                
                .pdf-only input, 
                .pdf-only textarea {
                    font-size: 4px !important;
                    padding: 1px !important;
                    height: 10px !important;
                    line-height: 1 !important;
                }
                
                .pdf-only #workContent_copy {
                    height: 25px !important;
                    line-height: 23px !important;
                    background-image: linear-gradient(to bottom, transparent 23px, #333 23px, #333 24px, transparent 24px) !important;
                }
                
                .pdf-only #specialNotes_copy {
                    height: 65px !important;
                    line-height: 20px !important;
                    background-image: 
                        linear-gradient(to bottom, transparent 20px, #333 20px, #333 21px, transparent 21px),
                        linear-gradient(to bottom, transparent 40px, #333 40px, #333 41px, transparent 41px),
                        linear-gradient(to bottom, transparent 60px, #333 60px, #333 61px, transparent 61px) !important;
                }
                
                .grid {
                    gap: 1px !important;
                }
            }
        }
        
        @media (max-width: 640px) {
            .mobile-stack { flex-direction: column; }
            .mobile-full { width: 100%; margin-bottom: 12px; }
            .mobile-scroll { overflow-x: auto; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- í—¤ë” -->
    <header class="header-bg text-white shadow-lg relative">
        <div class="container mx-auto px-4 py-6">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                <div class="relative z-10">
                    <h1 class="text-2xl md:text-3xl font-bold mb-2">ì² ë„ì‹ í˜¸ì œì–´ì‹œì„¤ ì‘ì—…ì¼ì§€</h1>
                    <p class="text-blue-100 text-sm">Railway Signal Control Facility Work Log</p>
                </div>
                <div class="flex gap-2 mt-4 md:mt-0 relative z-10 no-print">
                    <button onclick="autoSave()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg text-sm font-medium transition-all">
                        ğŸ’¾ ìë™ì €ì¥
                    </button>
                    <button onclick="exportPDF()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg text-sm font-medium transition-all">
                        ğŸ“„ PDFì¶œë ¥
                    </button>
                    <button id="install-app" onclick="showInstallPrompt()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg text-sm font-medium transition-all" style="display: none;">
                        ğŸ“² ì•±ì„¤ì¹˜
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-6 max-w-6xl">
        <!-- ê¸°ë³¸ ì •ë³´ -->
        <section class="card p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-6 border-b-2 border-blue-100 pb-2">ğŸ“… ê¸°ë³¸ ì •ë³´</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label for="workDate" class="block text-sm font-medium text-gray-700 mb-2">ì‘ì—… ë‚ ì§œ *</label>
                    <input type="date" id="workDate" tabindex="1" 
                           class="tooltip w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           data-tooltip="ì‘ì—…ì„ ìˆ˜í–‰í•œ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”">
                </div>
                <div>
                    <label for="temperature" class="block text-sm font-medium text-gray-700 mb-2">í˜„ì¥ ì˜¨ë„</label>
                    <input type="text" id="temperature" tabindex="2" placeholder="22.5â„ƒ"
                           class="tooltip w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           data-tooltip="í˜„ì¥ì˜ ì˜¨ë„ë¥¼ ê¸°ë¡í•´ì£¼ì„¸ìš” (ì˜ˆ: 22.5â„ƒ)">
                </div>
                <div>
                    <label for="humidity" class="block text-sm font-medium text-gray-700 mb-2">í˜„ì¥ ìŠµë„</label>
                    <input type="text" id="humidity" tabindex="3" placeholder="55%"
                           class="tooltip w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           data-tooltip="í˜„ì¥ì˜ ìŠµë„ë¥¼ ê¸°ë¡í•´ì£¼ì„¸ìš” (ì˜ˆ: 55%)">
                </div>
            </div>
        </section>

        <!-- ì‘ì—… ëŒ€ìƒ ë° ì¸ì› -->
        <section class="card p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-6 border-b-2 border-blue-100 pb-2">ğŸ‘¥ ì‘ì—… ëŒ€ìƒ ë° ì¸ì›</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="workTarget" class="block text-sm font-medium text-gray-700 mb-2">ì‘ì—… ëŒ€ìƒ ì‹œì„¤ *</label>
                    <input type="text" id="workTarget" tabindex="4" placeholder="ì‹ í˜¸ê¸° ìƒ1ë²ˆ, ê¶¤ë„íšŒë¡œ 1DT, ì „ì² ì†Œ ë°°ì „ë°˜ ë“±"
                           class="tooltip w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           data-tooltip="ì‘ì—…ì„ ìˆ˜í–‰í•  ì‹ í˜¸ì œì–´ì‹œì„¤ì„ êµ¬ì²´ì ìœ¼ë¡œ ê¸°ë¡í•´ì£¼ì„¸ìš”">
                </div>
                <div>
                    <label for="workTeam" class="block text-sm font-medium text-gray-700 mb-2">ì‘ì—…ì ë° ì¸ì› *</label>
                    <input type="text" id="workTeam" tabindex="5" placeholder="ê¹€ì² ìˆ˜ ì™¸ 4ëª… (ì´ 5ëª…), ë°•ì˜í¬ íŒ€ì¥ ì™¸ 2ëª… ë“±"
                           class="tooltip w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           data-tooltip="ì‘ì—…ì— ì°¸ì—¬í•œ ì¸ì›ê³¼ ì´ ì¸ì›ìˆ˜ë¥¼ ê¸°ë¡í•´ì£¼ì„¸ìš”">
                </div>
            </div>
        </section>

        <!-- ì‘ì—… ë‚´ìš© -->
        <section class="card p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-6 border-b-2 border-blue-100 pb-2">ğŸ”§ ì‘ì—… ë‚´ìš©</h2>
            <div>
                <textarea id="workContent" tabindex="6" rows="1" 
                          placeholder="ì‹ í˜¸ê¸° ì ê²€ ë° ì²­ì†Œ"
                          class="tooltip lined-textarea w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-vertical"
                          data-tooltip="ìˆ˜í–‰í•œ ì‘ì—… ë‚´ìš©ì„ ê¸°ë¡í•´ì£¼ì„¸ìš”">
                </textarea>
            </div>
        </section>

        <!-- ì¸¡ì • ì¥ë¹„ ì •ë³´ -->
        <section class="card p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-6 border-b-2 border-blue-100 pb-2">ğŸ”¬ ì¸¡ì • ì¥ë¹„ ë° ë°©ë²•</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="testEquipment" class="block text-sm font-medium text-gray-700 mb-2">ì‚¬ìš© ì¸¡ì •í…ŒìŠ¤í„°ê¸°</label>
                    <input type="text" id="testEquipment" tabindex="7" placeholder="FLUKE 15B+ ë©€í‹°ë¯¸í„°, MEGGER MIT515 ì ˆì—°ì €í•­ê³„"
                           class="tooltip w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           data-tooltip="ì‚¬ìš©í•œ ì¸¡ì •ì¥ë¹„ì˜ ì œì¡°ì‚¬ì™€ ëª¨ë¸ëª…ì„ ê¸°ë¡í•´ì£¼ì„¸ìš”">
                </div>
                <div>
                    <label for="measureMethod" class="block text-sm font-medium text-gray-700 mb-2">ì¸¡ì • ë°©ë²•</label>
                    <input type="text" id="measureMethod" tabindex="8" placeholder="ì ˆì—°ì €í•­ 1,000V ê¸°ì¤€ ì¸¡ì •, DC ì „ì•• ì¸¡ì •"
                           class="tooltip w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           data-tooltip="ì¸¡ì •ì— ì‚¬ìš©í•œ ë°©ë²•ê³¼ ê¸°ì¤€ì„ ê¸°ë¡í•´ì£¼ì„¸ìš”">
                </div>
            </div>
        </section>

        <!-- íŠ¹ì´ì‚¬í•­ -->
        <section class="card p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-6 border-b-2 border-blue-100 pb-2">âš ï¸ íŠ¹ì´ì‚¬í•­</h2>
            <div>
                <textarea id="specialNotes" tabindex="9" rows="3" 
                          placeholder="ìš°ì²œìœ¼ë¡œ ì¸í•œ ì‘ì—… ì§€ì—°
ì‹ í˜¸ê¸° LED ì ë“± ë¶ˆëŸ‰
ì ˆì—°ì €í•­ ê¸°ì¤€ì¹˜ ë¯¸ë‹¬"
                          class="tooltip lined-textarea w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-vertical"
                          data-tooltip="ì‘ì—… ì¤‘ ë°œìƒí•œ íŠ¹ì´ì‚¬í•­ì„ ê¸°ë¡í•´ì£¼ì„¸ìš”">
                </textarea>
            </div>
            <div class="mt-4 text-sm text-gray-600">
                ğŸ’¡ íŠ¹ì´ì‚¬í•­ì´ ë°œìƒí•œ ê²½ìš° êµ¬ì²´ì ì¸ ë‚´ìš©ê³¼ ì·¨í•œ ì¡°ì¹˜ì‚¬í•­ì„ ìƒì„¸íˆ ê¸°ë¡í•´ì£¼ì„¸ìš”.
            </div>
        </section>
    </main>

    <!-- PDF ì „ìš© ë³µì œë³¸ (ìˆ¨ê²¨ì§) -->
    <div id="pdf-duplicate" class="pdf-only" style="display: none;">
        <main class="container mx-auto px-4 py-6 max-w-6xl">
            <!-- ê¸°ë³¸ ì •ë³´ -->
            <section class="card p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-6 border-b-2 border-blue-100 pb-2">ğŸ“… ê¸°ë³¸ ì •ë³´</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì‘ì—… ë‚ ì§œ *</label>
                        <input type="text" id="workDate_copy" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">í˜„ì¥ ì˜¨ë„</label>
                        <input type="text" id="temperature_copy" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">í˜„ì¥ ìŠµë„</label>
                        <input type="text" id="humidity_copy" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    </div>
                </div>
            </section>

            <!-- ì‘ì—… ëŒ€ìƒ ë° ì¸ì› -->
            <section class="card p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-6 border-b-2 border-blue-100 pb-2">ğŸ‘¥ ì‘ì—… ëŒ€ìƒ ë° ì¸ì›</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì‘ì—… ëŒ€ìƒ ì‹œì„¤ *</label>
                        <input type="text" id="workTarget_copy" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì‘ì—…ì ë° ì¸ì› *</label>
                        <input type="text" id="workTeam_copy" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    </div>
                </div>
            </section>

            <!-- ì‘ì—… ë‚´ìš© -->
            <section class="card p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-6 border-b-2 border-blue-100 pb-2">ğŸ”§ ì‘ì—… ë‚´ìš©</h2>
                <div>
                    <textarea id="workContent_copy" readonly rows="1" 
                              class="lined-textarea w-full px-3 py-2 border border-gray-300 rounded-lg resize-vertical">
                    </textarea>
                </div>
            </section>

            <!-- ì¸¡ì • ì¥ë¹„ ì •ë³´ -->
            <section class="card p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-6 border-b-2 border-blue-100 pb-2">ğŸ”¬ ì¸¡ì • ì¥ë¹„ ë° ë°©ë²•</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì‚¬ìš© ì¸¡ì •í…ŒìŠ¤í„°ê¸°</label>
                        <input type="text" id="testEquipment_copy" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì¸¡ì • ë°©ë²•</label>
                        <input type="text" id="measureMethod_copy" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    </div>
                </div>
            </section>

            <!-- íŠ¹ì´ì‚¬í•­ -->
            <section class="card p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-6 border-b-2 border-blue-100 pb-2">âš ï¸ íŠ¹ì´ì‚¬í•­</h2>
                <div>
                    <textarea id="specialNotes_copy" readonly rows="3" 
                              class="lined-textarea w-full px-3 py-2 border border-gray-300 rounded-lg resize-vertical">
                    </textarea>
                </div>
            </section>
        </main>
    </div>

    <!-- í•˜ë‹¨ ë²„íŠ¼ -->
    <footer class="bg-white border-t border-gray-200 py-4 no-print sticky bottom-0">
        <div class="container mx-auto px-4">
            <div class="flex flex-wrap justify-center gap-2 md:gap-4">
                <button onclick="saveToLocal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-all flex items-center gap-2">
                    ğŸ’¾ ë¡œì»¬ ì €ì¥
                </button>
                <button onclick="loadFromLocal()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-all flex items-center gap-2">
                    ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°
                </button>
                <button onclick="exportPDF()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-all flex items-center gap-2">
                    ğŸ–¨ï¸ PDF ì¶œë ¥
                </button>
                <button onclick="clearAll()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-all flex items-center gap-2">
                    ğŸ—‘ï¸ ì „ì²´ ì´ˆê¸°í™”
                </button>
            </div>
        </div>
    </footer>

    <script>
        // ìë™ ì €ì¥ ê¸°ëŠ¥
        let autoSaveInterval;
        
        // í˜ì´ì§€ ë¡œë“œì‹œ ìë™ ë¶ˆëŸ¬ì˜¤ê¸°
        document.addEventListener('DOMContentLoaded', function() {
            // ë¬¸ì œê°€ ìˆëŠ” ë°ì´í„° ìë™ ì •ë¦¬
            cleanupOldData();
            // ìë™ì €ì¥ íŒŒì¼ì´ ìˆìœ¼ë©´ ìë™ ë¡œë“œ
            const autoSaved = localStorage.getItem('railwayWorkLog_auto');
            if (autoSaved) {
                try {
                    const data = JSON.parse(autoSaved);
                    restoreFormData(data);
                    console.log('ìë™ ì €ì¥ ë°ì´í„° ë¡œë“œë¨');
                } catch (error) {
                    console.error('ìë™ ì €ì¥ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                }
            }
            startAutoSave();
            
            // ì˜¤ëŠ˜ ë‚ ì§œ ìë™ ì„¤ì •
            if (!document.getElementById('workDate').value) {
                document.getElementById('workDate').value = new Date().toISOString().split('T')[0];
            }
            
            // Service Worker ë“±ë¡ (PWA ì§€ì›)
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./sw.js')
                    .then(function(registration) {
                        console.log('Service Worker ë“±ë¡ ì„±ê³µ:', registration);
                    })
                    .catch(function(error) {
                        console.log('Service Worker ë“±ë¡ ì‹¤íŒ¨:', error);
                    });
            }
        });
        
        // ì´ì „ ë°°ì—´ ë°ì´í„° ì •ë¦¬ í•¨ìˆ˜
        function cleanupOldData() {
            const manualData = localStorage.getItem('railwayWorkLog');
            const autoData = localStorage.getItem('railwayWorkLog_auto');
            
            let needsCleanup = false;
            
            // ìˆ˜ë™ ì €ì¥ ë°ì´í„° í™•ì¸
            if (manualData) {
                try {
                    const data = JSON.parse(manualData);
                    if (Array.isArray(data.workContent) || Array.isArray(data.specialNotes)) {
                        console.log('ì´ì „ ë°°ì—´ í˜•íƒœ ë°ì´í„° ê°ì§€ë¨ - ì •ë¦¬ ì¤‘...');
                        needsCleanup = true;
                    }
                } catch (e) {
                    needsCleanup = true;
                }
            }
            
            // ìë™ ì €ì¥ ë°ì´í„° í™•ì¸
            if (autoData) {
                try {
                    const data = JSON.parse(autoData);
                    if (Array.isArray(data.workContent) || Array.isArray(data.specialNotes)) {
                        console.log('ì´ì „ ë°°ì—´ í˜•íƒœ ìë™ì €ì¥ ë°ì´í„° ê°ì§€ë¨ - ì •ë¦¬ ì¤‘...');
                        needsCleanup = true;
                    }
                } catch (e) {
                    needsCleanup = true;
                }
            }
            
            // ë¬¸ì œê°€ ìˆëŠ” ë°ì´í„° ì‚­ì œ
            if (needsCleanup) {
                localStorage.removeItem('railwayWorkLog');
                localStorage.removeItem('railwayWorkLog_auto');
                console.log('âœ… ì´ì „ ë°ì´í„° ì •ë¦¬ ì™„ë£Œ');
                
                // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                setTimeout(() => {
                    alert('ğŸ”„ ì´ì „ ë²„ì „ì˜ ë°ì´í„° í˜•ì‹ì´ ê°ì§€ë˜ì–´ ìë™ìœ¼ë¡œ ì •ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.\nìƒˆë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                }, 500);
            }
        }
        
        // ìë™ ì €ì¥ ì‹œì‘
        function startAutoSave() {
            autoSaveInterval = setInterval(autoSave, 30000); // 30ì´ˆë§ˆë‹¤ ìë™ ì €ì¥
        }
        
        // ìë™ ì €ì¥ í•¨ìˆ˜
        function autoSave() {
            const data = collectFormData();
            localStorage.setItem('railwayWorkLog_auto', JSON.stringify(data));
            console.log('ìë™ ì €ì¥ ì™„ë£Œ:', new Date().toLocaleString());
        }
        
        // í¼ ë°ì´í„° ìˆ˜ì§‘
        function collectFormData() {
            const data = {
                timestamp: new Date().toISOString(),
                workDate: document.getElementById('workDate').value,
                temperature: document.getElementById('temperature').value,
                humidity: document.getElementById('humidity').value,
                workTarget: document.getElementById('workTarget').value,
                workTeam: document.getElementById('workTeam').value,
                testEquipment: document.getElementById('testEquipment').value,
                measureMethod: document.getElementById('measureMethod').value,
                workContent: '',
                specialNotes: ''
            };
            
            // ì‘ì—… ë‚´ìš© ìˆ˜ì§‘
            data.workContent = document.getElementById('workContent').value;
            
            // íŠ¹ì´ì‚¬í•­ ìˆ˜ì§‘
            data.specialNotes = document.getElementById('specialNotes').value;
            
            return data;
        }
        
        // í¼ ë°ì´í„° ë³µì›
        function restoreFormData(data) {
            if (!data) return;
            
            document.getElementById('workDate').value = data.workDate || '';
            document.getElementById('temperature').value = data.temperature || '';
            document.getElementById('humidity').value = data.humidity || '';
            document.getElementById('workTarget').value = data.workTarget || '';
            document.getElementById('workTeam').value = data.workTeam || '';
            document.getElementById('testEquipment').value = data.testEquipment || '';
            document.getElementById('measureMethod').value = data.measureMethod || '';
            
            // ì‘ì—… ë‚´ìš© ë³µì› (ì´ì „ ë°°ì—´ í˜•íƒœ ë°ì´í„° ì²˜ë¦¬)
            let workContentText = '';
            if (Array.isArray(data.workContent)) {
                // ì´ì „ ë°°ì—´ í˜•íƒœ ë°ì´í„°ë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜
                workContentText = data.workContent.map(work => {
                    const parts = [];
                    if (work.item) parts.push(work.item);
                    if (work.detail) parts.push(work.detail);
                    if (work.time) parts.push(`(${work.time})`);
                    if (work.note) parts.push(`[${work.note}]`);
                    return parts.join(' - ');
                }).filter(line => line.trim()).join('\n');
            } else {
                workContentText = data.workContent || '';
            }
            document.getElementById('workContent').value = workContentText;
            
            // íŠ¹ì´ì‚¬í•­ ë³µì› (ì´ì „ ë°°ì—´ í˜•íƒœ ë°ì´í„° ì²˜ë¦¬)
            let specialNotesText = '';
            if (Array.isArray(data.specialNotes)) {
                // ì´ì „ ë°°ì—´ í˜•íƒœ ë°ì´í„°ë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜
                specialNotesText = data.specialNotes.map(special => {
                    const parts = [];
                    if (special.date) parts.push(`[${special.date}]`);
                    if (special.item) parts.push(special.item);
                    if (special.content) parts.push(special.content);
                    if (special.action) parts.push(`â†’ ${special.action}`);
                    if (special.remark) parts.push(`(${special.remark})`);
                    return parts.join(' ');
                }).filter(line => line.trim()).join('\n');
            } else {
                specialNotesText = data.specialNotes || '';
            }
            document.getElementById('specialNotes').value = specialNotesText;
        }
        
        // ë¡œì»¬ ì €ì¥
        function saveToLocal() {
            const data = collectFormData();
            
            // ê¸°ë³¸ íŒŒì¼ëª… ìƒì„± (ë‚ ì§œ ê¸°ë°˜)
            const today = new Date().toISOString().split('T')[0];
            const defaultName = `ì‘ì—…ì¼ì§€_${data.workDate || today}`;
            
            // íŒŒì¼ëª… ì…ë ¥ ëª¨ë‹¬ í‘œì‹œ
            showSaveModal(defaultName, data);
        }
        
        // ì €ì¥ ëª¨ë‹¬ í‘œì‹œ
        function showSaveModal(defaultName, data) {
            const modalHTML = `
                <div id="saveModal" style="
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                    background: rgba(0,0,0,0.5); display: flex; align-items: center; 
                    justify-content: center; z-index: 1000;
                ">
                    <div style="
                        background: white; padding: 20px; border-radius: 10px; 
                        max-width: 400px; width: 90%; box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                    ">
                        <h3 style="margin: 0 0 15px 0; color: #1f2937; font-size: 18px; font-weight: bold;">
                            ğŸ’¾ íŒŒì¼ëª…ì„ ì…ë ¥í•˜ì„¸ìš”
                        </h3>
                        <input type="text" id="fileNameInput" value="${defaultName}" style="
                            width: 100%; padding: 10px; border: 1px solid #d1d5db; 
                            border-radius: 5px; margin-bottom: 15px; font-size: 14px;
                            box-sizing: border-box;
                        ">
                        <div id="saveMessage" style="
                            margin-bottom: 15px; padding: 10px; border-radius: 5px; 
                            display: none; font-size: 14px;
                        "></div>
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button onclick="closeSaveModal()" style="
                                padding: 8px 16px; background: #6b7280; color: white; 
                                border: none; border-radius: 5px; cursor: pointer;
                            ">ì·¨ì†Œ</button>
                            <button onclick="confirmSave()" style="
                                padding: 8px 16px; background: #2563eb; color: white; 
                                border: none; border-radius: 5px; cursor: pointer;
                            ">ì €ì¥</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // ë°ì´í„°ë¥¼ ëª¨ë‹¬ì— ì €ì¥
            document.getElementById('saveModal').setAttribute('data-form-data', JSON.stringify(data));
            
            // ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
            setTimeout(() => {
                const input = document.getElementById('fileNameInput');
                input.focus();
                input.select();
            }, 100);
        }
        
        // ì €ì¥ í™•ì¸
        function confirmSave() {
            const fileName = document.getElementById('fileNameInput').value.trim();
            const modal = document.getElementById('saveModal');
            const data = JSON.parse(modal.getAttribute('data-form-data'));
            
            if (!fileName) {
                showSaveMessage('âŒ íŒŒì¼ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            try {
                const key = `railwayWorkLog_${fileName}`;
                localStorage.setItem(key, JSON.stringify(data));
                showSaveMessage(`âœ… "${fileName}" íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                
                setTimeout(() => {
                    closeSaveModal();
                }, 1500);
            } catch (error) {
                showSaveMessage('âŒ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        // ì €ì¥ ë©”ì‹œì§€ í‘œì‹œ
        function showSaveMessage(message, type) {
            const messageDiv = document.getElementById('saveMessage');
            messageDiv.textContent = message;
            messageDiv.style.display = 'block';
            messageDiv.style.background = type === 'success' ? '#dcfce7' : '#fef2f2';
            messageDiv.style.color = type === 'success' ? '#166534' : '#dc2626';
            messageDiv.style.border = `1px solid ${type === 'success' ? '#bbf7d0' : '#fecaca'}`;
        }
        
        // ì €ì¥ ëª¨ë‹¬ ë‹«ê¸°
        function closeSaveModal() {
            const modal = document.getElementById('saveModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // ë¡œì»¬ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadFromLocal() {
            try {
                // ì €ì¥ëœ íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
                const savedFiles = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('railwayWorkLog_')) {
                        const fileName = key.replace('railwayWorkLog_', '');
                        savedFiles.push({ key, fileName });
                    }
                }
                
                // ìë™ ì €ì¥ íŒŒì¼ë„ í™•ì¸
                if (localStorage.getItem('railwayWorkLog_auto')) {
                    savedFiles.push({ key: 'railwayWorkLog_auto', fileName: 'ìë™ì €ì¥ íŒŒì¼' });
                }
                
                if (savedFiles.length === 0) {
                    showToast('ğŸ“‚ ì €ì¥ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.', 'info');
                    return;
                }
                
                // ë“œë¡­ë‹¤ìš´ ëª¨ë‹¬ ìƒì„±
                showFileSelectModal(savedFiles);
                
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                alert('âŒ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // íŒŒì¼ ì„ íƒ ëª¨ë‹¬ í‘œì‹œ
        function showFileSelectModal(files) {
            // ëª¨ë‹¬ HTML ìƒì„±
            const modalHTML = `
                <div id="fileSelectModal" style="
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                    background: rgba(0,0,0,0.5); display: flex; align-items: center; 
                    justify-content: center; z-index: 1000;
                ">
                    <div style="
                        background: white; padding: 20px; border-radius: 10px; 
                        max-width: 400px; width: 90%; box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                    ">
                        <h3 style="margin: 0 0 15px 0; color: #1f2937; font-size: 18px; font-weight: bold;">
                            ğŸ“‚ ë¶ˆëŸ¬ì˜¬ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”
                        </h3>
                                                 <select id="fileSelect" style="
                             width: 100%; padding: 10px; border: 1px solid #d1d5db; 
                             border-radius: 5px; margin-bottom: 15px; font-size: 14px;
                         ">
                             <option value="">íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”...</option>
                             ${files.map(file => 
                                 `<option value="${file.key}">${file.fileName}</option>`
                             ).join('')}
                         </select>
                         <div id="fileMessage" style="
                             margin-bottom: 15px; padding: 10px; border-radius: 5px; 
                             display: none; font-size: 14px;
                         "></div>
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button onclick="closeFileSelectModal()" style="
                                padding: 8px 16px; background: #6b7280; color: white; 
                                border: none; border-radius: 5px; cursor: pointer;
                            ">ì·¨ì†Œ</button>
                            <button onclick="loadSelectedFile()" style="
                                padding: 8px 16px; background: #2563eb; color: white; 
                                border: none; border-radius: 5px; cursor: pointer;
                            ">ë¶ˆëŸ¬ì˜¤ê¸°</button>
                            <button onclick="deleteSelectedFile()" style="
                                padding: 8px 16px; background: #dc2626; color: white; 
                                border: none; border-radius: 5px; cursor: pointer;
                            ">ì‚­ì œ</button>
                        </div>
                    </div>
                </div>
            `;
            
            // ëª¨ë‹¬ì„ bodyì— ì¶”ê°€
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }
        
        // ì„ íƒëœ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadSelectedFile() {
            const select = document.getElementById('fileSelect');
            const selectedKey = select.value;
            
            if (!selectedKey) {
                showFileMessage('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            try {
                const saved = localStorage.getItem(selectedKey);
                if (saved) {
                    const data = JSON.parse(saved);
                    restoreFormData(data);
                    showFileMessage(`âœ… "${select.options[select.selectedIndex].text}" íŒŒì¼ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`, 'success');
                    setTimeout(() => {
                        closeFileSelectModal();
                    }, 1500);
                } else {
                    showFileMessage('âŒ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                console.error('íŒŒì¼ ë¡œë“œ ì˜¤ë¥˜:', error);
                showFileMessage('âŒ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        // ì„ íƒëœ íŒŒì¼ ì‚­ì œ
        function deleteSelectedFile() {
            const select = document.getElementById('fileSelect');
            const selectedKey = select.value;
            
            if (!selectedKey) {
                showFileMessage('ì‚­ì œí•  íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            const fileName = select.options[select.selectedIndex].text;
            showDeleteConfirm(selectedKey, fileName);
        }
        
        // ì‚­ì œ í™•ì¸ ëª¨ë‹¬
        function showDeleteConfirm(selectedKey, fileName) {
            const confirmHTML = `
                <div id="deleteConfirm" style="
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                    background: rgba(0,0,0,0.7); display: flex; align-items: center; 
                    justify-content: center; z-index: 1001;
                ">
                    <div style="
                        background: white; padding: 20px; border-radius: 10px; 
                        max-width: 350px; width: 90%; box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                    ">
                        <h3 style="margin: 0 0 15px 0; color: #dc2626; font-size: 18px; font-weight: bold;">
                            ğŸ—‘ï¸ íŒŒì¼ ì‚­ì œ
                        </h3>
                        <p style="margin: 0 0 20px 0; color: #374151;">
                            "${fileName}" íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br>
                            <span style="color: #dc2626; font-size: 12px;">ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</span>
                        </p>
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button onclick="closeDeleteConfirm()" style="
                                padding: 8px 16px; background: #6b7280; color: white; 
                                border: none; border-radius: 5px; cursor: pointer;
                            ">ì·¨ì†Œ</button>
                            <button onclick="confirmDelete('${selectedKey}', '${fileName}')" style="
                                padding: 8px 16px; background: #dc2626; color: white; 
                                border: none; border-radius: 5px; cursor: pointer;
                            ">ì‚­ì œ</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', confirmHTML);
        }
        
        // ì‚­ì œ ì‹¤í–‰
        function confirmDelete(selectedKey, fileName) {
            try {
                localStorage.removeItem(selectedKey);
                closeDeleteConfirm();
                showFileMessage(`âœ… "${fileName}" íŒŒì¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                
                // íŒŒì¼ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                setTimeout(() => {
                    closeFileSelectModal();
                    loadFromLocal();
                }, 1500);
            } catch (error) {
                showFileMessage('âŒ íŒŒì¼ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        // ì‚­ì œ í™•ì¸ ëª¨ë‹¬ ë‹«ê¸°
        function closeDeleteConfirm() {
            const modal = document.getElementById('deleteConfirm');
            if (modal) {
                modal.remove();
            }
        }
        
        // íŒŒì¼ ë©”ì‹œì§€ í‘œì‹œ
        function showFileMessage(message, type) {
            const messageDiv = document.getElementById('fileMessage');
            if (messageDiv) {
                messageDiv.textContent = message;
                messageDiv.style.display = 'block';
                messageDiv.style.background = type === 'success' ? '#dcfce7' : '#fef2f2';
                messageDiv.style.color = type === 'success' ? '#166534' : '#dc2626';
                messageDiv.style.border = `1px solid ${type === 'success' ? '#bbf7d0' : '#fecaca'}`;
            }
        }
        
        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ (í˜ì´ì§€ ì´ë™ ì—†ì´)
        function showToast(message, type) {
            const toastHTML = `
                <div id="toast" style="
                    position: fixed; top: 20px; right: 20px; z-index: 2000;
                    background: ${type === 'success' ? '#22c55e' : type === 'error' ? '#ef4444' : '#3b82f6'};
                    color: white; padding: 12px 20px; border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3); font-size: 14px;
                    max-width: 300px; animation: slideIn 0.3s ease-out;
                ">
                    ${message}
                </div>
                <style>
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                </style>
            `;
            
            // ê¸°ì¡´ í† ìŠ¤íŠ¸ ì œê±°
            const existingToast = document.getElementById('toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            document.body.insertAdjacentHTML('beforeend', toastHTML);
            
            // 3ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                const toast = document.getElementById('toast');
                if (toast) {
                    toast.style.animation = 'slideIn 0.3s ease-out reverse';
                    setTimeout(() => toast.remove(), 300);
                }
            }, 3000);
        }
        
        // ëª¨ë‹¬ ë‹«ê¸°
        function closeFileSelectModal() {
            const modal = document.getElementById('fileSelectModal');
            if (modal) {
                modal.remove();
            }
        }
        

        
        // PDF ì¶œë ¥
        function exportPDF() {
            // í˜„ì¬ ì…ë ¥ê°’ì„ ë³µì œë³¸ì— ë³µì‚¬
            copyDataToDuplicate();
            
            // ë‘ ë²ˆì§¸ ë³µì‚¬ë³¸ ìƒì„±
            createSecondCopy();
            
            // PDF ì¶œë ¥ ìµœì í™”
            setTimeout(() => {
                // ë·°í¬íŠ¸ ë©”íƒ€ íƒœê·¸ ì„ì‹œ ë³€ê²½ (ëª¨ë°”ì¼ ì „ìš©)
                const viewport = document.querySelector('meta[name="viewport"]');
                const originalContent = viewport.content;
                
                // ëª¨ë°”ì¼ì—ì„œ ìŠ¤ì¼€ì¼ ê³ ì •
                if (window.innerWidth <= 768) {
                    viewport.content = 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no';
                    
                    // bodyì— ì„ì‹œ ìŠ¤íƒ€ì¼ ì¶”ê°€
                    document.body.style.zoom = '1';
                    document.body.style.transform = 'scale(1)';
                    document.body.style.transformOrigin = 'top left';
                }
                
                // PDF ì¶œë ¥
                window.print();
                
                // ì¶œë ¥ í›„ ë³µì›
                setTimeout(() => {
                    viewport.content = originalContent;
                    if (window.innerWidth <= 768) {
                        document.body.style.zoom = '';
                        document.body.style.transform = '';
                        document.body.style.transformOrigin = '';
                    }
                }, 1500);
            }, 300);
        }
        
        // ë°ì´í„°ë¥¼ ë³µì œë³¸ì— ë³µì‚¬
        function copyDataToDuplicate() {
            document.getElementById('workDate_copy').value = document.getElementById('workDate').value;
            document.getElementById('temperature_copy').value = document.getElementById('temperature').value;
            document.getElementById('humidity_copy').value = document.getElementById('humidity').value;
            document.getElementById('workTarget_copy').value = document.getElementById('workTarget').value;
            document.getElementById('workTeam_copy').value = document.getElementById('workTeam').value;
            document.getElementById('workContent_copy').value = document.getElementById('workContent').value;
            document.getElementById('testEquipment_copy').value = document.getElementById('testEquipment').value;
            document.getElementById('measureMethod_copy').value = document.getElementById('measureMethod').value;
            document.getElementById('specialNotes_copy').value = document.getElementById('specialNotes').value;
        }
        
        // ë‘ ë²ˆì§¸ ë³µì‚¬ë³¸ ìƒì„± (IDëŠ” ë³€ê²½í•˜ì§€ ì•Šê³  ë™ì¼í•˜ê²Œ ìœ ì§€)
        function createSecondCopy() {
            const original = document.querySelector('#pdf-duplicate > main');
            const clone = original.cloneNode(true);
            
            // ë°ì´í„°ë„ ë³µì‚¬
            const originalInputs = original.querySelectorAll('input, textarea');
            const cloneInputs = clone.querySelectorAll('input, textarea');
            
            for (let i = 0; i < originalInputs.length; i++) {
                if (cloneInputs[i]) {
                    cloneInputs[i].value = originalInputs[i].value;
                }
            }
            
            document.getElementById('pdf-duplicate').appendChild(clone);
        }
        
        // ì „ì²´ ì´ˆê¸°í™”
        function clearAll() {
            if (confirm('âš ï¸ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤. ì •ë§ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // ëª¨ë“  ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.querySelectorAll('input, textarea').forEach(element => {
                    if (element.type === 'date') {
                        element.value = '';
                    } else {
                        element.value = '';
                    }
                });
                
                // ì˜¤ëŠ˜ ë‚ ì§œ ë‹¤ì‹œ ì„¤ì •
                document.getElementById('workDate').value = new Date().toISOString().split('T')[0];
                
                // localStorage ì´ˆê¸°í™” (ëª¨ë“  ì‘ì—…ì¼ì§€ íŒŒì¼ ì‚­ì œ)
                const keysToRemove = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('railwayWorkLog_')) {
                        keysToRemove.push(key);
                    }
                }
                keysToRemove.forEach(key => localStorage.removeItem(key));
                
                alert('âœ… ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì…ë ¥ ì‹œ ìë™ ì €ì¥ íŠ¸ë¦¬ê±°
        document.addEventListener('input', function(e) {
            if (e.target.matches('input, textarea, select')) {
                clearTimeout(window.inputTimeout);
                window.inputTimeout = setTimeout(autoSave, 2000); // 2ì´ˆ í›„ ìë™ ì €ì¥
            }
        });
        
        // í˜ì´ì§€ ë‚˜ê°€ê¸° ì „ ìë™ ì €ì¥
        window.addEventListener('beforeunload', function() {
            autoSave();
        });
        
        // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ê´€ë ¨
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            // ê¸°ë³¸ ë¸Œë¼ìš°ì € í”„ë¡¬í”„íŠ¸ ì°¨ë‹¨
            e.preventDefault();
            // ë‚˜ì¤‘ì— ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì´ë²¤íŠ¸ ì €ì¥
            deferredPrompt = e;
            // ì„¤ì¹˜ ë²„íŠ¼ í‘œì‹œ
            document.getElementById('install-app').style.display = 'block';
        });
        
        function showInstallPrompt() {
            if (deferredPrompt) {
                // ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ í‘œì‹œ
                deferredPrompt.prompt();
                // ì‚¬ìš©ìì˜ ì„ íƒì„ ê¸°ë‹¤ë¦¼
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('ì‚¬ìš©ìê°€ ì•± ì„¤ì¹˜ë¥¼ ìˆ˜ë½í–ˆìŠµë‹ˆë‹¤');
                    } else {
                        console.log('ì‚¬ìš©ìê°€ ì•± ì„¤ì¹˜ë¥¼ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤');
                    }
                    deferredPrompt = null;
                    document.getElementById('install-app').style.display = 'none';
                });
            } else {
                // iOS Safari ë˜ëŠ” ì´ë¯¸ ì„¤ì¹˜ëœ ê²½ìš°
                if (navigator.userAgent.match(/iPhone|iPad|iPod/)) {
                    alert('ğŸ“² Safari ë¸Œë¼ìš°ì €ì—ì„œ:\n1. í™”ë©´ í•˜ë‹¨ì˜ ê³µìœ  ë²„íŠ¼(â–¡â†—) í„°ì¹˜\n2. "í™ˆ í™”ë©´ì— ì¶”ê°€" ì„ íƒ\n3. ì•± ì´ë¦„ í™•ì¸ í›„ "ì¶”ê°€" í„°ì¹˜');
                } else {
                    alert('ğŸ“² Chrome ë¸Œë¼ìš°ì €ì—ì„œ:\n1. ìš°ìƒë‹¨ â‹® ë©”ë‰´ í„°ì¹˜\n2. "í™ˆ í™”ë©´ì— ì¶”ê°€" ë˜ëŠ” "ì•± ì„¤ì¹˜" ì„ íƒ\n3. ì„¤ì¹˜ í™•ì¸');
                }
            }
        }
        
        // PDF ì¶œë ¥ í›„ ë³µì œë³¸ ì •ë¦¬
        window.addEventListener('afterprint', function() {
            setTimeout(() => {
                // ë‘ ë²ˆì§¸ ë³µì‚¬ë³¸ ì œê±° (ì²« ë²ˆì§¸ëŠ” ìœ ì§€)
                const duplicate = document.getElementById('pdf-duplicate');
                if (duplicate) {
                    const mains = duplicate.querySelectorAll('main');
                    if (mains.length > 1) {
                        mains[1].remove();
                    }
                }
            }, 500);
        });
    </script>
</body>
</html>
